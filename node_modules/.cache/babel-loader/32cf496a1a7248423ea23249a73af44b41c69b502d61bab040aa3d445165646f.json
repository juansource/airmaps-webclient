{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport L from \"leaflet\";\nimport { defineComponent, ref, onMounted } from \"vue\";\nimport \"leaflet/dist/leaflet.css\";\nimport { LMap, LTileLayer } from \"@vue-leaflet/vue-leaflet\";\nimport \"@geoman-io/leaflet-geoman-free\";\nimport \"@geoman-io/leaflet-geoman-free/dist/leaflet-geoman.css\";\nexport default defineComponent({\n  name: \"MapView\",\n  components: {\n    LMap,\n    LTileLayer\n  },\n  setup() {\n    const map = ref(null);\n    const mapObject = ref(null);\n    const mapReady = ref(false);\n    const drawnText = ref(\"\");\n    const drawnRectangles = ref([]);\n    const mapLayer = {\n      zoom: 12,\n      center: [47.703711705924626, -122.14209459757434],\n      attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n    };\n    const selectedTileLayer = ref({\n      url: \"http://127.0.0.1:8000/cog/tiles/%7Bz%7D/%7Bx%7D/%7By%7D?tileMatrixSetId=WebMercatorQuad&scale=1&url=https%3A%2F%2Fproject-kiwi-temp.s3.us-west-2.amazonaws.com%2Fodm_orthophoto.tif&unscale=false&resampling=nearest&reproject=nearest&return_mask=true\",\n      layerType: \"base\",\n      name: \"orthophotofromTitiler\"\n    });\n    const hookUpDraw = async () => {\n      mapObject.value = map.value.leafletObject;\n      mapReady.value = true;\n      mapObject.value.pm.setLang(\"en_gb\");\n      mapObject.value.pm.addControls({\n        position: \"topleft\",\n        drawMarker: false,\n        drawCircleMarker: false,\n        drawPolygon: false,\n        drawPolyline: false,\n        drawRectangle: true,\n        drawCircle: false,\n        drawText: false,\n        removalMode: true\n      });\n      mapObject.value.on(\"pm:create\", handleDrawingClick);\n      mapObject.value.on(\"pm:remove\", handleObjectRemoval);\n      loadDrawnRectangles();\n    };\n    const handleDrawingClick = e => {\n      const layer = e.layer;\n      if (layer instanceof L.Rectangle) {\n        drawnText.value = prompt(\"Enter text:\");\n        if (drawnText.value) {\n          layer.bindPopup(drawnText.value).openPopup();\n        }\n        drawnRectangles.value.push({\n          layer,\n          text: drawnText.value\n        });\n        saveDrawnRectangles();\n      }\n    };\n    const handleObjectRemoval = e => {\n      const removedLayer = e.layer;\n      const index = drawnRectangles.value.findIndex(item => item.layer === removedLayer);\n      drawnRectangles.value.splice(index, 1);\n      saveDrawnRectangles();\n    };\n    const saveDrawnRectangles = () => {\n      const rectanglesData = drawnRectangles.value.map(({\n        layer,\n        text\n      }) => {\n        return {\n          type: \"Feature\",\n          properties: {\n            popupMessage: text || \"\"\n          },\n          geometry: layer.toGeoJSON()\n        };\n      });\n      localStorage.setItem(\"drawnRectangles\", JSON.stringify(rectanglesData));\n    };\n    const loadDrawnRectangles = () => {\n      const savedRectangles = localStorage.getItem(\"drawnRectangles\");\n      if (savedRectangles) {\n        const rectanglesData = JSON.parse(savedRectangles);\n        rectanglesData.forEach(rectangleData => {\n          const drawnRectangle = L.geoJSON(rectangleData.geometry);\n          if (rectangleData.properties && rectangleData.properties.popupMessage) {\n            drawnRectangle.bindPopup(rectangleData.properties.popupMessage);\n          }\n          drawnRectangle.addTo(mapObject.value);\n          drawnRectangles.value.push({\n            layer: drawnRectangle,\n            text: rectangleData.properties.popupMessage\n          });\n        });\n      }\n    };\n    onMounted(() => {\n      window.addEventListener(\"beforeunload\", saveDrawnRectangles);\n    });\n    return {\n      map,\n      mapReady,\n      mapLayer,\n      hookUpDraw,\n      selectedTileLayer,\n      drawnText\n    };\n  }\n});","map":{"version":3,"names":["L","defineComponent","ref","onMounted","LMap","LTileLayer","name","components","setup","map","mapObject","mapReady","drawnText","drawnRectangles","mapLayer","zoom","center","attribution","selectedTileLayer","url","layerType","hookUpDraw","value","leafletObject","pm","setLang","addControls","position","drawMarker","drawCircleMarker","drawPolygon","drawPolyline","drawRectangle","drawCircle","drawText","removalMode","on","handleDrawingClick","handleObjectRemoval","loadDrawnRectangles","e","layer","Rectangle","prompt","bindPopup","openPopup","push","text","saveDrawnRectangles","removedLayer","index","findIndex","item","splice","rectanglesData","type","properties","popupMessage","geometry","toGeoJSON","localStorage","setItem","JSON","stringify","savedRectangles","getItem","parse","forEach","rectangleData","drawnRectangle","geoJSON","addTo","window","addEventListener"],"sources":["/Users/juangonzalez/Documents/GitHub/vue-project-kiwi/Clinet/src/components/LeafLet.vue"],"sourcesContent":["<template>\r\n  <div class=\"map\">\r\n  \r\n    <l-map style=\"width: 100%; height: 100%\" ref=\"map\" @ready=\"hookUpDraw\" :zoom=\"mapLayer.zoom\"\r\n      :center=\"mapLayer.center\">\r\n      <template v-if=\"mapReady\">\r\n        <l-tile-layer :url=\"selectedTileLayer.url\" :attribution=\"mapLayer.attribution\"></l-tile-layer>\r\n      </template>\r\n    </l-map>\r\n\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport L from \"leaflet\";\r\nimport { defineComponent, ref, onMounted } from \"vue\";\r\n\r\nimport \"leaflet/dist/leaflet.css\";\r\nimport { LMap, LTileLayer } from \"@vue-leaflet/vue-leaflet\";\r\n\r\nimport \"@geoman-io/leaflet-geoman-free\";\r\nimport \"@geoman-io/leaflet-geoman-free/dist/leaflet-geoman.css\";\r\n\r\nexport default defineComponent({\r\n  name: \"MapView\",\r\n  components: {\r\n    LMap,\r\n    LTileLayer,\r\n  },\r\n  setup() {\r\n    const map = ref(null);\r\n    const mapObject = ref(null);\r\n    const mapReady = ref(false);\r\n    const drawnText = ref(\"\");\r\n    const drawnRectangles = ref([]);\r\n\r\n    const mapLayer = {\r\n      zoom: 12,\r\n      center: [47.703711705924626, -122.14209459757434],\r\n      attribution:\r\n        '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\r\n    };\r\n\r\n    const selectedTileLayer = ref({\r\n      url: \"http://127.0.0.1:8000/cog/tiles/%7Bz%7D/%7Bx%7D/%7By%7D?tileMatrixSetId=WebMercatorQuad&scale=1&url=https%3A%2F%2Fproject-kiwi-temp.s3.us-west-2.amazonaws.com%2Fodm_orthophoto.tif&unscale=false&resampling=nearest&reproject=nearest&return_mask=true\",\r\n      layerType: \"base\",\r\n      name: \"orthophotofromTitiler\",\r\n    });\r\n\r\n    \r\n\r\n    const hookUpDraw = async () => {\r\n      mapObject.value = map.value.leafletObject;\r\n      mapReady.value = true;\r\n      mapObject.value.pm.setLang(\"en_gb\");\r\n      mapObject.value.pm.addControls({\r\n        position: \"topleft\",\r\n        drawMarker: false,\r\n        drawCircleMarker: false,\r\n        drawPolygon: false,\r\n        drawPolyline: false,\r\n        drawRectangle: true,\r\n        drawCircle: false,\r\n        drawText: false,\r\n        removalMode: true,\r\n      });\r\n      mapObject.value.on(\"pm:create\", handleDrawingClick);\r\n      mapObject.value.on(\"pm:remove\", handleObjectRemoval);\r\n      loadDrawnRectangles();\r\n    };\r\n\r\n    const handleDrawingClick = (e) => {\r\n      const layer = e.layer;\r\n      if (layer instanceof L.Rectangle) {\r\n        drawnText.value = prompt(\"Enter text:\"); \r\n        if (drawnText.value) {\r\n          layer.bindPopup(drawnText.value).openPopup();\r\n        }\r\n        drawnRectangles.value.push({ layer, text: drawnText.value });\r\n        saveDrawnRectangles();\r\n      }\r\n    };\r\n\r\n    const handleObjectRemoval = (e) => {\r\n      const removedLayer = e.layer;\r\n      const index = drawnRectangles.value.findIndex(item => item.layer === removedLayer);\r\n      drawnRectangles.value.splice(index, 1);\r\n      saveDrawnRectangles();\r\n    };\r\n\r\n    const saveDrawnRectangles = () => {\r\n      const rectanglesData = drawnRectangles.value.map(({ layer, text }) => {\r\n        return {\r\n          type: \"Feature\",\r\n          properties: {\r\n            popupMessage: text || \"\" \r\n          },\r\n          geometry: layer.toGeoJSON()\r\n        };\r\n      });\r\n      localStorage.setItem(\"drawnRectangles\", JSON.stringify(rectanglesData));\r\n    };\r\n\r\n    const loadDrawnRectangles = () => {\r\n      const savedRectangles = localStorage.getItem(\"drawnRectangles\");\r\n      if (savedRectangles) {\r\n        const rectanglesData = JSON.parse(savedRectangles);\r\n        rectanglesData.forEach(rectangleData => {\r\n          const drawnRectangle = L.geoJSON(rectangleData.geometry);\r\n          if (rectangleData.properties && rectangleData.properties.popupMessage) {\r\n            drawnRectangle.bindPopup(rectangleData.properties.popupMessage);\r\n          }\r\n          drawnRectangle.addTo(mapObject.value); \r\n          drawnRectangles.value.push({ layer: drawnRectangle, text: rectangleData.properties.popupMessage });\r\n        });\r\n      }\r\n    };\r\n\r\n    onMounted(() => {\r\n      window.addEventListener(\"beforeunload\", saveDrawnRectangles);\r\n    });\r\n\r\n    return {\r\n      map,\r\n      mapReady,\r\n      mapLayer,\r\n      hookUpDraw,\r\n      selectedTileLayer,\r\n      drawnText\r\n    };\r\n  },\r\n});\r\n</script>\r\n\r\n<style>\r\n.map {\r\n  height: 100vh;\r\n}\r\n</style>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}